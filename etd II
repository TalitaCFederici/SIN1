DROP SCHEMA EST_II;

CREATE SCHEMA EST_II;

USE EST_II;

CREATE TABLE IF NOT EXISTS PASSAGEIROS (
    ID_PASS INT PRIMARY KEY,
    NOME_PASS VARCHAR(50) NOT NULL,
    CPF_PASS INT,
    TELEFONE_PASS VARCHAR(15),
    CIDADE_PASS VARCHAR(50) NOT NULL,
    ESTADO_PASS VARCHAR(50) NOT NULL,
    PAIS_PASS VARCHAR(50) NOT NULL,
    NUMRUA_PASS INT,
    RUA_PASS VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS AEROPORTOS (
    AERO_COD INT PRIMARY KEY,
    AERO_NOME VARCHAR(50) NOT NULL,
    AERO_LOCAL VARCHAR(100) NOT NULL,
    AERO_PAIS VARCHAR(25) NOT NULL,
    AERO_LONGITUDE DECIMAL(10, 8),
    AERO_LATITUDE DECIMAL(10, 8)
);

CREATE TABLE IF NOT EXISTS AERONAVES (
    COD_AERONAVE INT PRIMARY KEY,
    AERONAVE_FABRICANTE VARCHAR(30) NOT NULL,
    AERONAVE_CAPACIDADE INT,
    AERONAVE_ANOFABR DATE NOT NULL,
    AERONAVE_MODELO VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS FUNCIONARIOS (
    ID_FUNC INT PRIMARY KEY,
    FUNC_FUNCAO VARCHAR(50) NOT NULL,
    FUNC_NOME VARCHAR(45) NOT NULL,
    FUNC_DATANASC DATE NOT NULL,
    FUNC_TELEFONE VARCHAR(15)
);

CREATE TABLE IF NOT EXISTS VOOS (
    COD_VOO INT PRIMARY KEY,
    ORIGEM_VOO INT,		 #REFERÊNCIA A AEROPORTOS
    DESTINO_VOO INT,	 #REFERÊNCIA A AEROPORTOS
    DATA_VOO DATE NOT NULL, 
    HORA_PARTIDA TIME NOT NULL,
    HORA_CHEGADA TIME NOT NULL,
    ID_AERONAVES INT NOT NULL,		 #ADD REFERÊNCIA
    CONSTRAINT FK_ORIGEM FOREIGN KEY (ORIGEM_VOO) REFERENCES AEROPORTOS(AERO_COD),
    CONSTRAINT FK_DESTINO FOREIGN KEY (DESTINO_VOO) REFERENCES AEROPORTOS(AERO_COD),
    CONSTRAINT FK_AERONAVE FOREIGN KEY (ID_AERONAVES) REFERENCES AERONAVES(COD_AERONAVE)
);
#CRIAÇÃO DA TABELAS ASSOCIATIVAS!
CREATE TABLE IF NOT EXISTS EQUIPES (
    FNCO_FUNCIONARIOS INT NOT NULL,  
    FNCO_VOOS INT NOT NULL,  
    PRIMARY KEY(FNCO_FUNCIONARIOS, FNCO_VOOS), 
    CONSTRAINT FNC_FK_FUNCIONARIOS FOREIGN KEY (FNCO_FUNCIONARIOS) REFERENCES FUNCIONARIOS(ID_FUNC),
    CONSTRAINT FNC_FK_VOOS FOREIGN KEY (FNCO_VOOS) REFERENCES VOOS(COD_VOO)
);

CREATE TABLE IF NOT EXISTS OPERACOES_VOO (
    ID_OPERACAO INT PRIMARY KEY,
    COD_VOO INT NOT NULL,
    FNCO_FUNCIONARIOS INT NOT NULL,
    DATA_OPERACAO DATE NOT NULL,
    CONSTRAINT FK_OPERA_VOO FOREIGN KEY (COD_VOO) REFERENCES VOOS(COD_VOO),
    CONSTRAINT FK_OPERA_FUNCIONARIO FOREIGN KEY (FNCO_FUNCIONARIOS) REFERENCES FUNCIONARIOS(ID_FUNC)
);

#CRIAÇÃO DA ALTER TABLE.
ALTER TABLE EQUIPES 
ADD CONSTRAINT FNCO_FK_FUNCIONARIOS FOREIGN KEY (FNCO_FUNCIONARIOS) REFERENCES FUNCIONARIOS(ID_FUNC);
ALTER TABLE EQUIPES 
ADD CONSTRAINT FNCO_FK_VOOS FOREIGN KEY (FNCO_VOOS) REFERENCES VOOS(COD_VOO);
ALTER TABLE OPERACOES_VOO 
ADD CONSTRAINT FK_OPERACAO_VOO FOREIGN KEY (COD_VOO) REFERENCES VOOS(COD_VOO);
ALTER TABLE OPERACOES_VOO 
ADD CONSTRAINT FK_OPERACAO_FUNCIONARIO FOREIGN KEY (FNCO_FUNCIONARIOS) REFERENCES FUNCIONARIOS(ID_FUNC);



